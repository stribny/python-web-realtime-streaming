var TimeChart=function(t,e,i,n){"use strict";function s(e){const i=t.rgb(e);return[i.r/255,i.g/255,i.b/255,i.opacity]}class o{constructor(t,e,i){this.options=e;const n=document.createElement("canvas"),o=n.style;o.position="absolute",o.width=o.height="100%",o.left=o.right=o.top=o.bottom="0",t.shadowRoot.appendChild(n),this.gl=function(t,e){if(!e){const e=t.getContext("webgl2");if(e)return e}const i=t.getContext("webgl");if(i)return i;throw new Error("Unable to initialize WebGL. Your browser or machine may not support it.")}(n,e.forceWebGL1);const a=s(e.backgroundColor);this.gl.clearColor(...a),this.canvas=n,i.updated.on((()=>{this.clear(),this.syncViewport()})),i.resized.on(((t,e)=>this.onResize(t,e))),i.disposing.on((()=>{t.shadowRoot.removeChild(n),n.width=0,n.height=0;const e=this.gl.getExtension("WEBGL_lose_context");e&&e.loseContext()}))}syncViewport(){const t=this.options,e=t.pixelRatio;this.gl.viewport(t.renderPaddingLeft*e,t.renderPaddingBottom*e,this.canvas.width-(t.renderPaddingLeft+t.renderPaddingRight)*e,this.canvas.height-(t.renderPaddingTop+t.renderPaddingBottom)*e)}onResize(t,e){const i=this.canvas,n=this.options.pixelRatio;i.width=t*n,i.height=e*n,this.syncViewport()}clear(){const t=this.gl;t.clear(t.COLOR_BUFFER_BIT)}}class a{constructor(t,e,i){this.node=document.createElement("div"),this.node.style.position="absolute",this.node.style.left=`${i.paddingLeft}px`,this.node.style.right=`${i.paddingRight}px`,this.node.style.top=`${i.paddingTop}px`,this.node.style.bottom=`${i.paddingBottom}px`,t.shadowRoot.appendChild(this.node),e.disposing.on((()=>{t.shadowRoot.removeChild(this.node)}))}}function r(t,e,i,n,s){if(e>=i)return e;if(n<=s(t[e]))return e;if(n>s(t[i-1]))return i;for(i-=1;e+1<i;){const o=s(t[e]),a=s(t[i]),r=a<=o?0:(n-o)/(a-o);let h=Math.ceil(e+r*(i-e));h===i?h--:h===e&&h++;s(t[h])<n?e=h:i=h}return i}class h{constructor(){this.callbacks=[]}on(t){this.callbacks.push(t)}dispatch(...t){for(const e of this.callbacks)e(...t)}}class d{constructor(t,e,i,n){this.canvas=t,this.model=e,this.options=i,this.dataPoints=new Map,this.lastPointerPos=null,this.updated=new h,n.node.addEventListener("mousemove",(e=>{const i=t.canvas.getBoundingClientRect();this.lastPointerPos={x:e.clientX-i.left,y:e.clientY-i.top},this.adjustPoints()})),n.node.addEventListener("mouseleave",(t=>{this.lastPointerPos=null,this.adjustPoints()})),e.updated.on((()=>this.adjustPoints()))}adjustPoints(){if(null===this.lastPointerPos)this.dataPoints.clear();else{const t=this.model.xScale.invert(this.lastPointerPos.x);for(const e of this.options.series){if(0==e.data.length||!e.visible){this.dataPoints.delete(e);continue}const i=r(e.data,0,e.data.length,t,(t=>t.x)),n=[];i>0&&n.push(e.data[i-1]),i<e.data.length&&n.push(e.data[i]);const s=e=>Math.abs(e.x-t);n.sort(((t,e)=>s(t)-s(e)));const o=this.model.pxPoint(n[0]),a=this.canvas.canvas.clientWidth,h=this.canvas.canvas.clientHeight;o.x<=a&&o.x>=0&&o.y<=h&&o.y>=0?this.dataPoints.set(e,n[0]):this.dataPoints.delete(e)}}this.updated.dispatch()}}function l(t,e,i){let n=-1/0,s=1/0;for(let o=e;o<i;o++){const e=t[o].y;e>n&&(n=e),e<s&&(s=e)}return{max:n,min:s}}class c{constructor(t){this.options=t,this.xScale=e.scaleLinear(),this.yScale=e.scaleLinear(),this.xRange=null,this.yRange=null,this.resized=new h,this.updated=new h,this.disposing=new h,this.disposed=!1,this.redrawRequested=!1,"auto"!==t.xRange&&t.xRange&&this.xScale.domain([t.xRange.min,t.xRange.max]),"auto"!==t.yRange&&t.yRange&&this.yScale.domain([t.yRange.min,t.yRange.max])}resize(t,e){const i=this.options;this.xScale.range([i.paddingLeft,t-i.paddingRight]),this.yScale.range([e-i.paddingBottom,i.paddingTop]),this.resized.dispatch(t,e),this.requestRedraw()}dispose(){this.disposed||(this.disposing.dispatch(),this.disposed=!0)}update(){this.updateModel(),this.updated.dispatch();for(const t of this.options.series)t.data._synced()}updateModel(){const t=this.options.series.filter((t=>t.data.length>0));if(0===t.length)return;const e=this.options;{const i=Math.max(...t.map((t=>t.data[t.data.length-1].x))),n=Math.min(...t.map((t=>t.data[0].x)));if(this.xRange={max:i,min:n},this.options.realTime||"auto"===e.xRange)if(this.options.realTime){const t=this.xScale.domain(),e=t[1]-t[0];this.xScale.domain([i-e,i])}else this.xScale.domain([n,i]);else e.xRange&&this.xScale.domain([e.xRange.min,e.xRange.max])}{const i=t.flatMap((t=>[l(t.data,0,t.data.pushed_front),l(t.data,t.data.length-t.data.pushed_back,t.data.length)]));this.yRange&&i.push(this.yRange),this.yRange=function(...t){return{min:Math.min(...t.map((t=>t.min))),max:Math.max(...t.map((t=>t.max)))}}(...i),"auto"===e.yRange?this.yScale.domain([this.yRange.min,this.yRange.max]).nice():e.yRange&&this.yScale.domain([e.yRange.min,e.yRange.max])}}requestRedraw(){this.redrawRequested||(this.redrawRequested=!0,requestAnimationFrame((t=>{this.redrawRequested=!1,this.disposed||this.update()})))}pxPoint(t){return{x:this.xScale(t.x),y:this.yScale(t.y)}}}class p{constructor(t,e){this.svgNode=document.createElementNS("http://www.w3.org/2000/svg","svg");const i=this.svgNode.style;i.position="absolute",i.width=i.height="100%",i.left=i.right=i.top=i.bottom="0",t.shadowRoot.appendChild(this.svgNode),e.disposing.on((()=>{t.shadowRoot.removeChild(this.svgNode)}))}}class u extends Array{constructor(){super(...arguments),this.pushed_back=0,this.pushed_front=0,this.poped_back=0,this.poped_front=0,this.pushed_back=this.length}_synced(){this.pushed_back=this.poped_back=this.pushed_front=this.poped_front=0}static _from_array(t){if(t instanceof u)return t;const e=Object.setPrototypeOf(t,u.prototype);return e.poped_back=e.pushed_front=e.poped_front=0,e.pushed_back=e.length,e}push(...t){return this.pushed_back+=t.length,super.push(...t)}pop(){const t=this.length,e=super.pop();return void 0===e||(this.pushed_back>0?this.pushed_back--:t-this.pushed_front>0?this.poped_back++:this.pushed_front--),e}unshift(...t){return this.pushed_front+=t.length,super.unshift(...t)}shift(){const t=this.length,e=super.shift();return void 0===e||(this.pushed_front>0?this.pushed_front--:t-this.pushed_back>0?this.poped_front++:this.pushed_back--),e}updateDelete(t,e,i){if(0===e)return;const n=t=>(i-=t,0===(e-=t));if(t<this.pushed_front){const i=Math.min(e,this.pushed_front-t);if(this.pushed_front-=i,n(i))return}if(t===this.pushed_front){const t=Math.min(e,i-this.pushed_front-this.pushed_back);if(this.poped_front+=t,n(t))return}if(t>this.pushed_front&&t<i-this.pushed_back){if(t+e<i-this.pushed_back)throw new RangeError("DataPoints that already synced to GPU cannot be delete in the middle");const s=Math.min(e,i-t-this.pushed_back);if(this.poped_back+=s,n(s))return}const s=Math.min(e,i-t);if(this.pushed_back-=s,!n(s))throw new Error("BUG")}updateInsert(t,e,i){if(t<=this.pushed_front)this.pushed_front+=e;else{if(!(t>=i-this.pushed_back))throw new RangeError("DataPoints cannot be inserted in the middle of the range that is already synced to GPU");this.pushed_back+=e}}splice(t,e,...i){t===-1/0?t=0:t<0&&(t=Math.max(this.length+t,0)),e=void 0===e?this.length-t:Math.min(Math.max(e,0),this.length-t),this.updateDelete(t,e,this.length),this.updateInsert(t,i.length,this.length-e);const n=this.length-e+i.length,s=super.splice(t,e,...i);if(this.length!==n)throw new Error(`BUG! length after splice not expected. ${this.length} vs ${n}`);return s}}const m={pixelRatio:window.devicePixelRatio,lineWidth:1,backgroundColor:t.rgb(0,0,0,0),paddingTop:10,paddingRight:10,paddingLeft:45,paddingBottom:20,renderPaddingTop:0,renderPaddingRight:0,renderPaddingLeft:0,renderPaddingBottom:0,xRange:"auto",yRange:"auto",realTime:!1,baseTime:0,xScaleType:e.scaleTime,debugWebGL:!1,forceWebGL1:!1,legend:!0,tooltip:!1,tooltipXLabel:"X"},g={name:"",color:null,visible:!0};function f(t){return t.data=t.data?u._from_array(t.data):new u,Object.setPrototypeOf(t,g),t}class v{constructor(t,e){var i,n;this.el=t,this.disposed=!1;const s=function(t,e){const i={series:[],color:getComputedStyle(t).getPropertyValue("color")},n=Object.assign({},i,e);return n.series=n.series.map((t=>f(t))),Object.setPrototypeOf(n,m),n}(t,e);this.model=new c(s);const r=null!==(i=t.shadowRoot)&&void 0!==i?i:t.attachShadow({mode:"open"}),h=document.createElement("style");h.innerText="\n:host {\n    contain: size layout paint style;\n    position: relative;\n}",r.appendChild(h),this.canvasLayer=new o(t,s,this.model),this.svgLayer=new p(t,this.model),this.contentBoxDetector=new a(t,this.model,s),this.nearestPoint=new d(this.canvasLayer,this.model,s,this.contentBoxDetector),this._options=s,this.plugins=Object.fromEntries(Object.entries(null!==(n=null==e?void 0:e.plugins)&&void 0!==n?n:{}).map((([t,e])=>[t,e.apply(this)]))),this.onResize();const l=()=>this.onResize();window.addEventListener("resize",l),this.model.disposing.on((()=>{window.removeEventListener("resize",l),r.removeChild(h)}))}get options(){return this._options}onResize(){this.model.resize(this.el.clientWidth,this.el.clientHeight)}update(){if(this.disposed)throw new Error("Cannot update after dispose.");for(let t=0;t<this.options.series.length;t++){const e=this.options.series[t];g.isPrototypeOf(e)||(this.options.series[t]=f(e))}this.model.requestRedraw()}dispose(){this.model.dispose(),this.disposed=!0}}var x;function y(t){return[{dir:x.X,op:t.x},{dir:x.Y,op:t.y}].filter((t=>void 0!==t.op))}function w(t){const e=t.domain(),i=t.range();return(e[1]-e[0])/(i[1]-i[0])}function b(t,e){const i=e[1]-e[0],n=t.scale.domain();if((n[1]-n[0])*i<=0)return!1;const s=Math.min(t.maxDomainExtent,t.maxDomain-t.minDomain,Math.max(t.minDomainExtent,i)),o=(s-i)/2;e[0]-=o,e[1]+=o;const a=Math.min(Math.max(t.minDomain-e[0],0),t.maxDomain-e[1]);e[0]+=a,e[1]+=a;const r=1e-6*s;return t.scale.domain(e),!!function(...t){return[...t[0]].map(((e,i)=>t.map((t=>t[i]))))}(e,n).some((([t,e])=>Math.abs(t-e)>r))}function E(t,e,i){return t>i?i:t<e?e:t}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.X=1]="X",t[t.Y=2]="Y"}(x||(x={}));class P{constructor(t,e){this.el=t,this.options=e,this.scaleUpdated=new h,this.previousPoint=null,t.style.userSelect="none",t.addEventListener("pointerdown",(t=>this.onMouseDown(t))),t.addEventListener("pointerup",(t=>this.onMouseUp(t))),t.addEventListener("pointermove",(t=>this.onMouseMove(t)))}point(t){const e=this.el.getBoundingClientRect();return{[x.X]:t.clientX-e.left,[x.Y]:t.clientY-e.top}}onMouseMove(t){if(null===this.previousPoint)return;const e=this.point(t);let i=!1;for(const{dir:t,op:n}of y(this.options)){const s=e[t]-this.previousPoint[t],o=w(n.scale),a=n.scale.domain();b(n,a.map((t=>t-o*s)))&&(i=!0)}this.previousPoint=e,i&&this.scaleUpdated.dispatch()}onMouseDown(t){"mouse"===t.pointerType&&(this.el.setPointerCapture(t.pointerId),this.previousPoint=this.point(t),this.el.style.cursor="grabbing")}onMouseUp(t){null!==this.previousPoint&&(this.previousPoint=null,this.el.releasePointerCapture(t.pointerId),this.el.style.cursor="")}}class S{constructor(t,e){this.el=t,this.options=e,this.scaleUpdated=new h,this.majorDirection=x.UNKNOWN,this.previousPoints=new Map,this.enabled={[x.X]:!1,[x.Y]:!1},t.addEventListener("touchstart",(t=>this.onTouchStart(t)),{passive:!0}),t.addEventListener("touchend",(t=>this.onTouchEnd(t)),{passive:!0}),t.addEventListener("touchcancel",(t=>this.onTouchEnd(t)),{passive:!0}),t.addEventListener("touchmove",(t=>this.onTouchMove(t)),{passive:!0}),this.update()}update(){this.syncEnabled(),this.syncTouchAction()}syncEnabled(){for(const{dir:t,op:e}of y(this.options))if(e){const i=e.scale.domain().sort();this.enabled[t]=e.minDomain<i[0]&&i[1]<e.maxDomain}else this.enabled[t]=!1}syncTouchAction(){const t=[];this.enabled[x.X]||t.push("pan-x"),this.enabled[x.Y]||t.push("pan-y"),0===t.length&&t.push("none"),this.el.style.touchAction=t.join(" ")}calcKB(t,e,i){if(t===this.majorDirection&&i.length>=2){const t=e.scale.domain(),n=t[1]-t[0];if(function(t){const e=t.reduce(((t,e)=>t+e))/t.length;return t.map((t=>(t-e)**2)).reduce(((t,e)=>t+e))/t.length}(i.map((t=>t.domain)))>1e-4*n*n)return function(t){let e=0,i=0,n=0,s=0;const o=t.length;for(const o of t)e+=o.x,i+=o.y,n+=o.x*o.y,s+=o.x*o.x;const a=o*s-e*e,r=0===a?0:(o*n-e*i)/a;return{k:r,b:(i-r*e)/o}}(i.map((t=>({x:t.current,y:t.domain}))))}const n=w(e.scale),s=i.map((t=>t.domain-n*t.current)).reduce(((t,e)=>t+e))/i.length;return{k:n,b:s}}touchPoints(t){const e=this.el.getBoundingClientRect(),i=new Map([...t].map((t=>[t.identifier,{[x.X]:t.clientX-e.left,[x.Y]:t.clientY-e.top}])));let n=!1;for(const{dir:t,op:e}of y(this.options)){const s=e.scale,o=[...i.entries()].map((([e,i])=>({current:i[t],previousPoint:this.previousPoints.get(e)}))).filter((t=>void 0!==t.previousPoint)).map((({current:e,previousPoint:i})=>({current:e,domain:s.invert(i[t])})));if(0===o.length)continue;const{k:a,b:r}=this.calcKB(t,e,o);b(e,s.range().map((t=>r+a*t)))&&(n=!0)}return this.previousPoints=i,n&&this.scaleUpdated.dispatch(),n}dirOptions(t){return{[x.X]:this.options.x,[x.Y]:this.options.y}[t]}onTouchStart(t){if(this.majorDirection===x.UNKNOWN&&t.touches.length>=2){const e=[...t.touches];function i(t){const e=t.reduce(((t,e)=>t+e))/t.length;return t.map((t=>(t-e)**2)).reduce(((t,e)=>t+e))}const n=i(e.map((t=>t.clientX))),s=i(e.map((t=>t.clientY)));this.majorDirection=n>s?x.X:x.Y,void 0===this.dirOptions(this.majorDirection)&&(this.majorDirection=x.UNKNOWN)}this.touchPoints(t.touches)}onTouchEnd(t){t.touches.length<2&&(this.majorDirection=x.UNKNOWN),this.touchPoints(t.touches)}onTouchMove(t){this.touchPoints(t.touches)}}class R{constructor(t,e){this.el=t,this.options=e,this.scaleUpdated=new h,t.addEventListener("wheel",(t=>this.onWheel(t)))}onWheel(t){t.preventDefault();let e=t.deltaX,i=t.deltaY;switch(t.deltaMode){case 1:e*=30,i*=30;break;case 2:e*=400,i*=400}const n={[x.X]:{translate:0,zoom:0},[x.Y]:{translate:0,zoom:0}};t.ctrlKey?t.altKey?(n[x.X].zoom=e,n[x.Y].zoom=i):n[x.X].zoom=e+i:t.altKey?(n[x.X].translate=e,n[x.Y].translate=i):n[x.X].translate=e+i;const s=this.el.getBoundingClientRect(),o={[x.X]:t.clientX-s.left,[x.Y]:t.clientY-s.top};let a=!1;for(const{dir:e,op:i}of y(this.options)){const s=i.scale.domain(),r=w(i.scale),h=n[e],d=i.scale.invert(o[e]);h.translate*=r,h.zoom*=.002,t.shiftKey&&(h.translate*=5,h.zoom*=5);const l=.4*(s[1]-s[0]);h.translate=E(h.translate,-l,l);const c=.5;h.zoom=E(h.zoom,-c,c);b(i,s.map((t=>t+h.translate+(t-d)*h.zoom)))&&(a=!0)}a&&this.scaleUpdated.dispatch()}}const _={minDomain:-1/0,maxDomain:1/0,minDomainExtent:0,maxDomainExtent:1/0};function C(t,e){e||(e={});const i=e=>{e&&!t.isPrototypeOf(e)&&Object.setPrototypeOf(e,t)};return i(e.x),i(e.y),e}class L{constructor(t,e){this.scaleUpdated=new h,e=null!=e?e:{},this.options=C(_,e),this.touch=new S(t,this.options),this.mouse=new P(t,this.options),this.wheel=new R(t,this.options);const i=()=>this.scaleUpdated.dispatch();this.touch.scaleUpdated.on(i),this.mouse.scaleUpdated.on(i),this.wheel.scaleUpdated.on(i)}onScaleUpdated(t){this.scaleUpdated.on(t)}update(){this.touch.update()}}class M{constructor(t,e){this.options=e,this.registerZoom(t)}applyAutoRange(t,e){if(!t)return;if(!t.autoRange)return delete t.minDomain,void delete t.maxDomain;let[i,n]=t.scale.domain();e&&(i=Math.min(i,e.min),n=Math.max(n,e.max)),t.minDomain=i,t.maxDomain=n}registerZoom(t){const e=new L(t.contentBoxDetector.node,{x:this.options.x&&Object.assign(Object.create(this.options.x),{scale:t.model.xScale}),y:this.options.y&&Object.assign(Object.create(this.options.y),{scale:t.model.yScale})}),i=e.options;t.model.updated.on((()=>{this.applyAutoRange(i.x,t.model.xRange),this.applyAutoRange(i.y,t.model.yRange),e.update()})),e.onScaleUpdated((()=>{t.options.xRange=null,t.options.yRange=null,t.options.realTime=!1,t.update()}))}}const T=Object.assign(Object.create(_),{autoRange:!0});class A{constructor(t){this.options=C(T,t)}apply(t){return new M(t,this.options)}}const k={apply(t){const e=function(t,e){const i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.classList.add("content-box"),i.x.baseVal.value=e.paddingLeft,i.y.baseVal.value=e.paddingRight,t.resized.on(((t,n)=>{i.width.baseVal.value=t-e.paddingRight-e.paddingLeft,i.height.baseVal.value=n-e.paddingTop-e.paddingBottom})),i}(t.model,t.options),i=e.createSVGTransform();i.setTranslate(0,0);const n=document.createElementNS("http://www.w3.org/2000/svg","style");n.textContent="\n.timechart-crosshair {\n    stroke: currentColor;\n    stroke-width: 1;\n    stroke-dasharray: 2 1;\n    visibility: hidden;\n}";const s=document.createElementNS("http://www.w3.org/2000/svg","line");s.transform.baseVal.initialize(i),s.x2.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PERCENTAGE,100);const o=document.createElementNS("http://www.w3.org/2000/svg","line");o.transform.baseVal.initialize(i),o.y2.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PERCENTAGE,100);const a=document.createElementNS("http://www.w3.org/2000/svg","g");a.classList.add("timechart-crosshair");for(const t of[n,s,o])a.appendChild(t);const r=t.contentBoxDetector;r.node.addEventListener("mousemove",(t=>{const i=e.getBoundingClientRect();s.transform.baseVal.getItem(0).setTranslate(0,t.clientY-i.y),o.transform.baseVal.getItem(0).setTranslate(t.clientX-i.x,0)})),r.node.addEventListener("mouseenter",(t=>a.style.visibility="visible")),r.node.addEventListener("mouseleave",(t=>a.style.visibility="hidden")),e.appendChild(a),t.svgLayer.svgNode.appendChild(e)}},N={apply(t){const e=n.select(t.svgLayer.svgNode),s=e.append("g"),o=e.append("g"),a=i.axisBottom(t.model.xScale),r=i.axisLeft(t.model.yScale);function h(){const e=t.model.xScale,i=t.options.xScaleType().domain(e.domain().map((e=>e+t.options.baseTime))).range(e.range());a.scale(i),s.call(a),r.scale(t.model.yScale),o.call(r)}t.model.updated.on(h),t.model.resized.on(((e,i)=>{const n=t.options;s.attr("transform",`translate(0, ${i-n.paddingBottom})`),o.attr("transform",`translate(${n.paddingLeft}, 0)`),h()}))}};class B{constructor(t,e,i){this.el=t,this.model=e,this.options=i,this.items=new Map,this.legend=document.createElement("chart-legend");const n=this.legend.style;n.position="absolute",n.right=`${i.paddingRight}px`,n.top=`${i.paddingTop}px`;const s=this.legend.attachShadow({mode:"open"}),o=document.createElement("style");o.textContent="\n:host {\n    background: var(--background-overlay, white);\n    border: 1px solid hsl(0, 0%, 80%);\n    border-radius: 3px;\n    padding: 5px 10px;\n}\n.item {\n    display: flex;\n    flex-flow: row nowrap;\n    align-items: center;\n    user-select: none;\n}\n.item:not(.visible) {\n    color: gray;\n    text-decoration: line-through;\n}\n.item .example {\n    width: 50px;\n    margin-right: 10px;\n    max-height: 1em;\n}",s.appendChild(o),this.itemContainer=s,this.update();const a=t.shadowRoot;a.appendChild(this.legend),e.updated.on((()=>this.update())),e.disposing.on((()=>{a.removeChild(this.legend)}))}update(){var t,e;if(this.legend.style.display=this.options.legend?"":"none",this.options.legend)for(const i of this.options.series){if(!this.items.has(i)){const t=document.createElement("div");t.className="item";const e=document.createElement("div");e.className="example",t.appendChild(e);const n=document.createElement("label");n.textContent=i.name,t.appendChild(n),this.itemContainer.appendChild(t),t.addEventListener("click",(t=>{i.visible=!i.visible,this.model.update()})),this.items.set(i,{item:t,example:e})}const n=this.items.get(i);n.item.classList.toggle("visible",i.visible),n.example.style.height=`${null!==(t=i.lineWidth)&&void 0!==t?t:this.options.lineWidth}px`,n.example.style.backgroundColor=(null!==(e=i.color)&&void 0!==e?e:this.options.color).toString()}}}const D={apply:t=>new B(t.el,t.model,t.options)};var O="undefined"!=typeof Float32Array?Float32Array:Array;function V(){var t=new O(2);return O!=Float32Array&&(t[0]=0,t[1]=0),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),V();function U(t,e,i,n){var s;const o=W(t.createShader(e));if(t.shaderSource(o,i),t.compileShader(o),n){if(!t.getShaderParameter(o,t.COMPILE_STATUS)){const e=null!==(s=t.getShaderInfoLog(o))&&void 0!==s?s:"Unknown Error.";throw t.deleteShader(o),new Error(e)}}return o}function W(t){if(!t)throw new Error("value must not be falsy");return t}class j extends class{constructor(t,e,i,n){this.gl=t,this.debug=n;const s=W(t.createProgram());t.attachShader(s,W(U(t,t.VERTEX_SHADER,e,n))),t.attachShader(s,W(U(t,t.FRAGMENT_SHADER,i,n))),this.program=s}link(){var t;const e=this.gl,i=this.program;if(e.linkProgram(i),this.debug){if(!e.getProgramParameter(i,e.LINK_STATUS)){const n=null!==(t=e.getProgramInfoLog(i))&&void 0!==t?t:"Unknown Error.";throw e.deleteProgram(i),new Error(n)}}}use(){this.gl.useProgram(this.program)}}{constructor(t,e){super(t,function(t){const e="\nuniform vec2 uModelScale;\nuniform vec2 uModelTranslation;\nuniform vec2 uProjectionScale;\nuniform float uLineWidth;\n\nvoid main() {\n    vec2 cssPose = uModelScale * aDataPoint + uModelTranslation;\n    vec2 dir = uModelScale * aDir;\n    dir = normalize(dir);\n    vec2 pos2d = uProjectionScale * (cssPose + vec2(-dir.y, dir.x) * uLineWidth);\n    gl_Position = vec4(pos2d, 0, 1);\n}";return t instanceof WebGLRenderingContext?`\nattribute vec2 aDataPoint;\nattribute vec2 aDir;\n${e}`:`#version 300 es\nlayout (location = 0) in vec2 aDataPoint;\nlayout (location = 1) in vec2 aDir;\n${e}`}(t),function(t){return t instanceof WebGLRenderingContext?"\nprecision lowp float;\nuniform vec4 uColor;\nvoid main() {\n    gl_FragColor = uColor;\n}":"#version 300 es\nprecision lowp float;\nuniform vec4 uColor;\nout vec4 outColor;\nvoid main() {\n    outColor = uColor;\n}"}(t),e),t instanceof WebGLRenderingContext&&(t.bindAttribLocation(this.program,0,"aDataPoint"),t.bindAttribLocation(this.program,1,"aDir")),this.link();const i=e=>W(t.getUniformLocation(this.program,e));this.locations={uModelScale:i("uModelScale"),uModelTranslation:i("uModelTranslation"),uProjectionScale:i("uProjectionScale"),uLineWidth:i("uLineWidth"),uColor:i("uColor")}}}const z=4*Float32Array.BYTES_PER_ELEMENT,F=131072,Y=524290;class G{constructor(t){this.gl=t,this.vao=W(t.createVertexArray()),this.bind()}bind(){this.gl.bindVertexArray(this.vao)}clear(){this.gl.deleteVertexArray(this.vao)}}class I{constructor(t){this.vaoExt=t,this.vao=W(t.createVertexArrayOES()),this.bind()}bind(){this.vaoExt.bindVertexArrayOES(this.vao)}clear(){this.vaoExt.deleteVertexArrayOES(this.vao)}}class X{constructor(t){this.bindFunc=t}bind(){this.bindFunc()}clear(){}}class ${constructor(t,e){this.gl=t,this.dataPoints=e,this.validStart=0,this.validEnd=0,this.dataBuffer=W(t.createBuffer());const i=()=>{t.bindBuffer(t.ARRAY_BUFFER,this.dataBuffer),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,z,0),t.enableVertexAttribArray(1),t.vertexAttribPointer(1,2,t.FLOAT,!1,z,2*Float32Array.BYTES_PER_ELEMENT)};if(t instanceof WebGLRenderingContext){const e=t.getExtension("OES_vertex_array_object");this.vao=e?new I(e):new X(i)}else this.vao=new G(t);i(),t.bufferData(t.ARRAY_BUFFER,2097160*Float32Array.BYTES_PER_ELEMENT,t.DYNAMIC_DRAW)}clear(){this.validStart=this.validEnd=0}delete(){this.clear(),this.gl.deleteBuffer(this.dataBuffer),this.vao.clear()}popBack(t){const e=Math.floor(this.validEnd/4)-t;return this.validEnd=Math.max(4*e,this.validStart),Math.floor(this.validStart/4)-e}popFront(t){const e=Math.floor(this.validStart/4)+t;return this.validStart=Math.min(4*e,this.validEnd),e-Math.floor(this.validEnd/4)}syncPoints(t,e,i){const n=this.dataPoints,s=i-e,o=new Float32Array(4*s);let a=0;const r=V(),h=V(),d=V(),l=V();function c(t,e){var i,n,s;r[0]=t.x,r[1]=t.y,h[0]=e.x,h[1]=e.y,n=r,s=h,(i=d)[0]=n[0]-s[0],i[1]=n[1]-s[1],function(t,e){var i=e[0],n=e[1],s=i*i+n*n;s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s}(d,d),function(t,e){t[0]=-e[0],t[1]=-e[1]}(l,d)}function p(t){o[a]=t[0],o[a+1]=t[1],a+=2}const u=Math.floor(s/4);let m=n[t-1];for(let e=0;e<u;e++){const i=n[t+e];c(i,m),m=i,p(h),p(d),p(h),p(l),p(r),p(d),p(r),p(l)}if(a<o.length&&(c(n[t+u],m),p(h),p(d),p(h),p(l)),a!==o.length)throw Error("BUG!");const g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,this.dataBuffer),g.bufferSubData(g.ARRAY_BUFFER,z*e,o)}pushBack(t){this.validStart===this.validEnd&&(this.validStart=this.validEnd=0);const e=this.validEnd;this.validEnd=Math.min(Y,this.validEnd+4*t);const i=Math.floor((this.validEnd-e)/4);return this.syncPoints(this.dataPoints.length-t,e,this.validEnd),t-i}pushFront(t){this.validStart===this.validEnd&&(this.validStart=this.validEnd=Y);const e=this.validStart;this.validStart=Math.max(0,4*(Math.floor(this.validStart/4)-t));const i=Math.floor((e-this.validStart)/4);return this.syncPoints(t-i+1,this.validStart,e),t-i}draw(t){const e=Math.max(this.validStart,4*t.min),i=Math.min(this.validEnd,4*t.max)-e,n=this.gl;return this.vao.bind(),n.drawArrays(n.TRIANGLE_STRIP,e,i),Math.floor(i/4)}}class K{constructor(t,e){this.gl=t,this.series=e,this.vertexArrays=[]}popFront(){let t=this.series.data.poped_front;if(0!==t)for(;;){const e=this.vertexArrays[0];if(t=e.popFront(t),t<0)break;e.delete(),this.vertexArrays.shift()}}popBack(){let t=this.series.data.poped_back;if(0!==t)for(;;){const e=this.vertexArrays[this.vertexArrays.length-1];if(t=e.popBack(t),t<0)break;e.delete(),this.vertexArrays.pop()}}newArray(){return new $(this.gl,this.series.data)}pushFront(){let t,e=this.series.data.pushed_front;if(0===e)return;const i=()=>{t=this.newArray(),this.vertexArrays.unshift(t)};if(0===this.vertexArrays.length){if(e<2)return;i(),e--}for(t=this.vertexArrays[0];e=t.pushFront(e),!(e<=0);)i()}pushBack(){let t,e=this.series.data.pushed_back;if(0===e)return;const i=()=>{t=this.newArray(),this.vertexArrays.push(t)};if(0===this.vertexArrays.length){if(e<2)return;i(),e--}for(t=this.vertexArrays[this.vertexArrays.length-1];e=t.pushBack(e),!(e<=0);)i()}syncBuffer(){this.popFront(),this.popBack(),this.pushFront(),this.pushBack()}draw(t){const e=this.series.data;if(0===this.vertexArrays.length||e[0].x>t.max||e[e.length-1].x<t.min)return;let i=this.vertexArrays[0].validStart/4-1;const n=t=>t.x,s=r(e,1,e.length,t.min,n)+i,o=r(e,s,e.length-1,t.max,n)+1+i,a=Math.floor(s/F),h=Math.ceil(o/F);for(let t=a;t<h;t++){const e=t*F;i+=this.vertexArrays[t].draw({min:s-e,max:o-e})}}}class q{constructor(t,e,i){this.model=t,this.gl=e,this.options=i,this.program=new j(this.gl,this.options.debugWebGL),this.arrays=new Map,this.height=0,this.width=0,this.renderHeight=0,this.renderWidth=0,this.program.use(),t.updated.on((()=>this.drawFrame())),t.resized.on(((t,e)=>this.onResize(t,e)))}syncBuffer(){for(const t of this.options.series){let e=this.arrays.get(t);e||(e=new K(this.gl,t),this.arrays.set(t,e)),e.syncBuffer()}}syncViewport(){this.renderWidth=this.width-this.options.renderPaddingLeft-this.options.renderPaddingRight,this.renderHeight=this.height-this.options.renderPaddingTop-this.options.renderPaddingBottom;const t=(e=this.renderWidth,i=this.renderHeight,(n=new O(2))[0]=e,n[1]=i,n);var e,i,n;!function(t,e,i){t[0]=e[0]/i[0],t[1]=e[1]/i[1]}(t,[2,2],t),this.gl.uniform2fv(this.program.locations.uProjectionScale,t)}onResize(t,e){this.height=e,this.width=t}drawFrame(){var t,e;this.syncBuffer(),this.syncDomain();const i=this.gl;for(const[n,o]of this.arrays){if(!n.visible)continue;const a=s(null!==(t=n.color)&&void 0!==t?t:this.options.color);i.uniform4fv(this.program.locations.uColor,a);const r=null!==(e=n.lineWidth)&&void 0!==e?e:this.options.lineWidth;i.uniform1f(this.program.locations.uLineWidth,r/2);const h={min:this.model.xScale.invert(this.options.renderPaddingLeft-r/2),max:this.model.xScale.invert(this.width-this.options.renderPaddingRight+r/2)};o.draw(h)}if(this.options.debugWebGL){const t=i.getError();if(t!=i.NO_ERROR)throw new Error(`WebGL error ${t}`)}}ySvgToView(t){return-t+this.renderHeight/2+this.options.renderPaddingTop}xSvgToView(t){return t-this.renderWidth/2-this.options.renderPaddingLeft}syncDomain(){this.syncViewport();const t=this.model,e=this.gl,i=[this.xSvgToView(t.xScale(0)),this.ySvgToView(t.yScale(0))],n=[this.xSvgToView(t.xScale(1)),this.ySvgToView(t.yScale(1))],s=[n[0]-i[0],n[1]-i[1]];e.uniform2fv(this.program.locations.uModelScale,s),e.uniform2fv(this.program.locations.uModelTranslation,i)}}const H={apply:t=>new q(t.model,t.canvasLayer.gl,t.options)};class Z{constructor(t,e,i,n){this.svg=t,this.options=e,this.model=i,this.pModel=n,this.intersectPoints=new Map;t.svgNode.createSVGTransform().setTranslate(0,0);const s=document.createElementNS("http://www.w3.org/2000/svg","style");s.textContent="\n.timechart-crosshair-intersect {\n    fill: var(--background-overlay, white);\n    visibility: hidden;\n}\n.timechart-crosshair-intersect circle {\n    r: 3px;\n}";const o=document.createElementNS("http://www.w3.org/2000/svg","g");o.classList.add("timechart-crosshair-intersect"),o.appendChild(s),this.container=o,this.adjustIntersectPoints(),t.svgNode.appendChild(o),n.updated.on((()=>this.adjustIntersectPoints()))}adjustIntersectPoints(){var t,e;const i=this.svg.svgNode.createSVGTransform();i.setTranslate(0,0);for(const n of this.options.series){if(!this.intersectPoints.has(n)){const s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.style.stroke=(null!==(t=n.color)&&void 0!==t?t:this.options.color).toString(),s.style.strokeWidth=`${null!==(e=n.lineWidth)&&void 0!==e?e:this.options.lineWidth}px`,s.transform.baseVal.initialize(i),this.container.appendChild(s),this.intersectPoints.set(n,s)}const s=this.intersectPoints.get(n),o=this.pModel.dataPoints.get(n);if(o){s.style.visibility="visible";const t=this.model.pxPoint(o);s.transform.baseVal.getItem(0).setTranslate(t.x,t.y)}else s.style.visibility="hidden"}}}const J={apply:t=>new Z(t.svgLayer,t.options,t.model,t.nearestPoint)};class Q{constructor(t,e,i,n){this.el=t,this.model=e,this.options=i,this.nearestPoint=n,this.items=new Map;this.tooltip=document.createElement("chart-tooltip");const s=this.tooltip.style;s.position="absolute",s.visibility="hidden";const o=this.tooltip.attachShadow({mode:"open"}),a=document.createElement("style");a.textContent="\n:host {\n    background: var(--background-overlay, white);\n    border: 1px solid hsl(0, 0%, 80%);\n    border-radius: 3px;\n    padding: 2px 2px;\n}\n.item {\n    user-select: none;\n}\ntd {\n    padding: 0px 5px;\n}\n.name {\n    margin-right: 10px;\n    max-width: 100px;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n}\n.example {\n    width: 6px;\n    height: 6px;\n}\n.value {\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    min-width: 100px;\n    max-width: 100px;\n    text-align: right;\n}\n.x-not-aligned .value {\n    opacity: 0.4;\n}\n",o.appendChild(a);const r=document.createElement("table");this.xItem=this.createItemElements(this.options.tooltipXLabel),r.appendChild(this.xItem.item),o.appendChild(r),this.itemContainer=r,this.update(),t.shadowRoot.appendChild(this.tooltip),e.updated.on((()=>this.update())),e.disposing.on((()=>{t.shadowRoot.removeChild(this.tooltip)})),n.updated.on((()=>{if(!i.tooltip||0==n.dataPoints.size)return void(s.visibility="hidden");s.visibility="visible";const t=n.lastPointerPos,o=this.tooltip.getBoundingClientRect();let a=t.x-o.width-12,r=t.y-o.height-12;a<0&&(a=t.x+12),r<0&&(r=t.y+12),s.left=a+"px",s.top=r+"px";let h=Number.POSITIVE_INFINITY,d=null;for(const[i,s]of n.dataPoints){const i=e.pxPoint(s),n=i.x-t.x,o=i.y-t.y,a=Math.sqrt(n*n+o*o);a<h&&(h=a,d=s.x)}this.xItem.value.textContent=d.toLocaleString();for(const t of this.options.series){if(!t.visible)continue;let e=n.dataPoints.get(t),i=this.items.get(t);i&&e&&(i.value.textContent=e.y.toLocaleString(),i.item.classList.toggle("x-not-aligned",e.x!==d))}}))}createItemElements(t){const e=document.createElement("tr");e.className="item";const i=document.createElement("td"),n=document.createElement("div");n.className="example",i.appendChild(n),e.appendChild(i);const s=document.createElement("td");s.className="name",s.textContent=t,e.appendChild(s);const o=document.createElement("td");return o.className="value",e.appendChild(o),{item:e,example:n,name:s,value:o}}update(){var t;for(const e of this.options.series){if(!this.items.has(e)){const t=this.createItemElements(e.name);this.itemContainer.appendChild(t.item),this.items.set(e,t)}const i=this.items.get(e);i.example.style.backgroundColor=(null!==(t=e.color)&&void 0!==t?t:this.options.color).toString(),i.item.style.display=e.visible?"":"none"}}}const tt={apply:t=>new Q(t.el,t.model,t.options,t.nearestPoint)};class et extends v{constructor(t,e){super(t,function(t){var e;const i=null!=t?t:{plugins:void 0,zoom:void 0};return Object.assign(Object.assign({},t),{plugins:Object.assign(Object.assign({},null!==(e=i.plugins)&&void 0!==e?e:{}),{lineChart:H,d3Axis:N,crosshair:k,nearestPoint:J,legend:D,zoom:new A(i.zoom),tooltip:tt})})}(e)),this.el=t}get options(){return this._options}}return et.core=v,et.plugins={lineChart:H,d3Axis:N,crosshair:k,nearestPoint:J,legend:D,TimeChartZoomPlugin:A,tooltip:tt},et}(d3,d3,d3,d3);
//# sourceMappingURL=timechart.min.js.map
